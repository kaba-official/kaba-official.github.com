
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115014323-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115014323-1');
  </script>
  <meta charset="utf-8">
  <title>The Volatile keyword | East River Village</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
  <meta name="description" content="A detailed discussion about volatile keyword.">
<meta name="keywords" content="c,gcc,compiler">
<meta property="og:type" content="article">
<meta property="og:title" content="The Volatile keyword">
<meta property="og:url" content="https://eastrivervillage.com/The-Volatile-keyword/index.html">
<meta property="og:site_name" content="East River Village">
<meta property="og:description" content="A detailed discussion about volatile keyword.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://eastrivervillage.com/images/the_volatile_keyword.jpeg">
<meta property="og:updated_time" content="2020-08-09T06:51:47.867Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Volatile keyword">
<meta name="twitter:description" content="A detailed discussion about volatile keyword.">
<meta name="twitter:image" content="https://eastrivervillage.com/images/the_volatile_keyword.jpeg">
  <link rel="icon" href="/favicon.ico">
  
  
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5LB7LCD');</script>
    <!-- End Google Tag Manager -->
  


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Merriweather|Lobster|Lora|Roboto Mono">
  <link rel="stylesheet" href="/css/style.css">
  
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "The Volatile keyword",
  "name": "The Volatile keyword",
  "image": "/images/the_volatile_keyword.jpeg",
  "datePublished": "2018-09-08T16:08:50.000Z",
  "dateModified": "2020-08-09T06:51:47.867Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://eastrivervillage.com/The-Volatile-keyword/index.html"
  },
  "author": {
    "@type": "Person",
    "name": "Balakumaran Kannan",
    "image": "/images/profile_author.jpg",
    "description": "System software engineer specilied in Linux. Experience spans from ARM32 board bring-up to multi datacenter virtualization stack management. Open source contributer. From Bangalore, India."
  },
  "publisher": {
    "@type": "Organization",
    "name": "Balakumaran Kannan",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/profile_author.jpg"
    }
  }
}
</script>

  
</head>
</html>
<body>
  
  
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5LB7LCD');</script>
    <!-- End Google Tag Manager -->
  


  <header class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a href="/" class="navbar-item">
      East River Village
    </a>
  </div>
</header>

  <div class="container">
    <div class="columns">
      <div style="overflow:hidden;" class="main column">
        <article class="post">
  <figure class="post-thumbnail">
    
  <img src="/images/the_volatile_keyword.jpeg" class="thumbnail " alt="The Volatile keyword">


  </figure>
  <span>2018-09-08
</span>
  <h1 class="title">The Volatile keyword</h1>
  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/c/">c</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/gcc/">gcc</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/compiler/">compiler</a>
    
  </div>


  <div class="content">
    <p>Recently I’ve interviewed some candidates for entry and intermediate level positions. One of the questions most of them struggled is about the <code>volatile</code> keyword. Some conversations went like this,</p>
<ul>
<li>Q: Why we use <code>volatile</code> keyword?</li>
<li>A: It will tell compiler not to use any registers for the <code>volatile</code> variable.</li>
<li>Q: Then how will it work in an ARM processor? In ARM no instruction other than load and store can use memory location.</li>
<li>A: ??!!</li>
</ul>
<ul>
<li>Q: What is the purpose <code>volatile</code> keyword?</li>
<li>A: We’ll use for IO memory</li>
<li>Q: Why we need it for IO memory?</li>
<li>A: So every time processor accesses the memory, it will go to IO device</li>
<li>Q: So <code>volatile</code> is to tell processor not to cache data?</li>
<li>A: Yes</li>
<li>Q: Thus <code>volatile</code> is a processor directive not compiler directive?</li>
<li>And confusion starts</li>
</ul>
<p>In this post, lets see how <code>volatile</code> works with two simple C programs. In complex programs with multiple variables and loops <code>volatile</code> keyword will make significant difference in speed and memory usage.</p>
<p>GCC provides many compiler optimization flags. Enabling them will aggressively optimize the code and give better performance in terms of speed and memory footprint. As these optimizations make debugging harder, they are not suitable development. All available GCC compiler optimization flags can be get from following command.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="variable">$CC</span> --<span class="built_in">help</span>=optimizers</span><br><span class="line">The following options control optimizations:</span><br><span class="line">  -O&lt;number&gt;                  Set optimization level to &lt;number&gt;.</span><br><span class="line">  -Ofast                      Optimize <span class="keyword">for</span> speed disregarding exact standards compliance.</span><br><span class="line">  -Og                         Optimize <span class="keyword">for</span> debugging experience rather than speed or size.</span><br><span class="line">  -Os                         Optimize <span class="keyword">for</span> space rather than speed.</span><br><span class="line">  -faggressive-loop-optimizations Aggressively optimize loops using language constraints.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></table></figure></p>
<p>For simplicity, I used only <code>-Ofast</code> optimizer for the examples. It informs GCC to do its best to make the program run faster. We’ll see how compiler builds, with and without <code>volatile</code>. GCC will give assembly code output with <code>-S</code> options.</p>
<p>Take the following C program.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> *x = (<span class="keyword">int</span> *)<span class="number">0xc000</span>;</span><br><span class="line">	<span class="keyword">int</span> b = *x;</span><br><span class="line">	<span class="keyword">int</span> c = *x;</span><br><span class="line">	*x = b + c;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Don’t worry about dereferencing a random virtual address. We are not going to run this program, just build the assembly code and examine manually. I use pointers in these programs. Because using immediate value makes no sense with volatile. We have an integer pointer <code>x</code> points to address <code>0xc000</code>. We initialize two variables <code>b</code> and <code>c</code> with value in address <code>0xc000</code>. And then addition of <code>b</code> and <code>c</code> is stored in location <code>0xc000</code>. So we read the value in location <code>0xc000</code> twice in this program. Let see how it gets compiled by GCC form ARMv8.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$CC</span></span><br><span class="line">aarch64-poky-linux-gcc --sysroot=/opt/poky/2.4.2/sysroots/aarch64-poky-linux</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/volatile/single_varuable_two_reads</span><br><span class="line">$ <span class="variable">$CC</span> -S -Ofast ./code.c -o code.S</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/volatile/single_varuable_two_reads</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">	.arch armv8-a</span><br><span class="line">	.file	&quot;code.c&quot;</span><br><span class="line">	.text</span><br><span class="line">	.section	.text.startup,&quot;ax&quot;,@progbits</span><br><span class="line">	.align	2</span><br><span class="line">	.p2align 3,,7</span><br><span class="line">	.global	main</span><br><span class="line">	.type	main, %function</span><br><span class="line">main:</span><br><span class="line">	mov	x2, 49152</span><br><span class="line">	mov	w0, 0</span><br><span class="line">	ldr	w1, [x2]</span><br><span class="line">	lsl	w1, w1, 1</span><br><span class="line">	str	w1, [x2]</span><br><span class="line">	ret</span><br><span class="line">	.size	main, .-main</span><br><span class="line">	.ident	&quot;GCC: (GNU) 7.3.0&quot;</span><br><span class="line">	.section	.note.GNU-stack,&quot;&quot;,@progbits</span><br></pre></td></tr></table></figure>
<p>The compiler intelligently finds that variable <code>b</code> and <code>c</code> have same value from address <code>0xc000</code> and addition of them is equivalent to multiplying the value at <code>0xc000</code> by two. So it loads the value into register <code>W1</code> and left shifts it by 1 (equivalent of multiplying with two) and then stores the new value into location <code>0xc000</code>.</p>
<p>Now lets change the code to use <code>volatile</code> for variable <code>x</code>. And see how the assembly code looks.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">volatile</span> <span class="keyword">int</span> *x = (<span class="keyword">int</span> *)<span class="number">0xc000</span>;</span><br><span class="line">	<span class="keyword">int</span> b = *x;</span><br><span class="line">	<span class="keyword">int</span> c = *x;</span><br><span class="line">	*x = b + c;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	.arch armv8-a</span><br><span class="line">	.file	&quot;code.c&quot;</span><br><span class="line">	.text</span><br><span class="line">	.section	.text.startup,&quot;ax&quot;,@progbits</span><br><span class="line">	.align	2</span><br><span class="line">	.p2align 3,,7</span><br><span class="line">	.global	main</span><br><span class="line">	.type	main, %function</span><br><span class="line">main:</span><br><span class="line">	mov	x1, 49152</span><br><span class="line">	mov	w0, 0</span><br><span class="line">	ldr	w2, [x1]</span><br><span class="line">	ldr	w3, [x1]</span><br><span class="line">	add	w2, w2, w3</span><br><span class="line">	str	w2, [x1]</span><br><span class="line">	ret</span><br><span class="line">	.size	main, .-main</span><br><span class="line">	.ident	&quot;GCC: (GNU) 7.3.0&quot;</span><br><span class="line">	.section	.note.GNU-stack,&quot;&quot;,@progbits</span><br></pre></td></tr></table></figure>
<p>This time the compiler considers that the value at location <code>0xc000</code> may be different each time it reads. It thinks that the variables <code>b</code> and <code>c</code> could be initialized with different values. So it reads the location <code>0xc000</code> twice and adds both values.</p>
<p>Lets see a simple loop case<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> *x = (<span class="keyword">int</span> *)<span class="number">0xc000</span>;</span><br><span class="line">	<span class="keyword">int</span> *y = (<span class="keyword">int</span> *)<span class="number">0xd000</span>;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; *y; i++) &#123;</span><br><span class="line">		sum = sum + *x;</span><br><span class="line">	&#125;</span><br><span class="line">	*x = sum;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>This program initializes two pointers <code>x</code> and <code>y</code> to locations <code>0xc000</code> and <code>0xd000</code> respectively. It adds the value at <code>x</code> to itself as many times the value at <code>y</code>. Lets see how GCC sees it.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">	.arch armv8-a</span><br><span class="line">	.file	&quot;code.c&quot;</span><br><span class="line">	.text</span><br><span class="line">	.section	.text.startup,&quot;ax&quot;,@progbits</span><br><span class="line">	.align	2</span><br><span class="line">	.p2align 3,,7</span><br><span class="line">	.global	main</span><br><span class="line">	.type	main, %function</span><br><span class="line">main:</span><br><span class="line">	mov	x0, 53248</span><br><span class="line">	ldr	w0, [x0]</span><br><span class="line">	cmp	w0, 0</span><br><span class="line">	ble	.L3</span><br><span class="line">	mov	x1, 49152</span><br><span class="line">	ldr	w1, [x1]</span><br><span class="line">	mul	w1, w0, w1</span><br><span class="line">.L2:</span><br><span class="line">	mov	x2, 49152</span><br><span class="line">	mov	w0, 0</span><br><span class="line">	str	w1, [x2]</span><br><span class="line">	ret</span><br><span class="line">.L3:</span><br><span class="line">	mov	w1, 0</span><br><span class="line">	b	.L2</span><br><span class="line">	.size	main, .-main</span><br><span class="line">	.ident	&quot;GCC: (GNU) 7.3.0&quot;</span><br><span class="line">	.section	.note.GNU-stack,&quot;&quot;,@progbits</span><br></pre></td></tr></table></figure></p>
<p>The compiler assigns register <code>X0</code> to <code>y</code> and register <code>X1</code> to <code>x</code>. The program compares the value at <code>[X0]</code> - value at the address in <code>X0</code> - with zero. If so, it jumps to <code>.L3</code> which sets <code>W1</code> to zero and jumps to <code>.L2</code>. Or it simply multiplies <code>[X0]</code> and <code>[X1]</code> and stores the value in <code>W1</code>. <code>.L2</code> stores the value in <code>W1</code> at <code>[X2]</code> and returns. The compiler intelligently identifies that adding <code>[X2]</code> to itself <code>[X1]</code> times is equivalent to multiplying both.</p>
<p>With <code>volatile</code>,<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">volatile</span> <span class="keyword">int</span> *x = (<span class="keyword">int</span> *)<span class="number">0xc000</span>;</span><br><span class="line">	<span class="keyword">int</span> *y = (<span class="keyword">int</span> *)<span class="number">0xd000</span>;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; *y; i++) &#123;</span><br><span class="line">		sum = sum + *x;</span><br><span class="line">	&#125;</span><br><span class="line">	*x = sum;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>the corresponding assembly code is<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">	.arch armv8-a</span><br><span class="line">	.file	&quot;code.c&quot;</span><br><span class="line">	.text</span><br><span class="line">	.section	.text.startup,&quot;ax&quot;,@progbits</span><br><span class="line">	.align	2</span><br><span class="line">	.p2align 3,,7</span><br><span class="line">	.global	main</span><br><span class="line">	.type	main, %function</span><br><span class="line">main:</span><br><span class="line">	mov	x0, 53248</span><br><span class="line">	ldr	w3, [x0]</span><br><span class="line">	cmp	w3, 0</span><br><span class="line">	ble	.L4</span><br><span class="line">	mov	w0, 0</span><br><span class="line">	mov	w1, 0</span><br><span class="line">	mov	x4, 49152</span><br><span class="line">	.p2align 2</span><br><span class="line">.L3:</span><br><span class="line">	ldr	w2, [x4]</span><br><span class="line">	add	w0, w0, 1</span><br><span class="line">	cmp	w0, w3</span><br><span class="line">	add	w1, w1, w2</span><br><span class="line">	bne	.L3</span><br><span class="line">.L2:</span><br><span class="line">	mov	x2, 49152</span><br><span class="line">	mov	w0, 0</span><br><span class="line">	str	w1, [x2]</span><br><span class="line">	ret</span><br><span class="line">.L4:</span><br><span class="line">	mov	w1, 0</span><br><span class="line">	b	.L2</span><br><span class="line">	.size	main, .-main</span><br><span class="line">	.ident	&quot;GCC: (GNU) 7.3.0&quot;</span><br><span class="line">	.section	.note.GNU-stack,&quot;&quot;,@progbits</span><br></pre></td></tr></table></figure></p>
<p>This time GCC uses <code>X4</code> for the address <code>0xc000</code>, but its not significant for our problem. Look here the loop is <code>.L3</code>. It loads the value at location <code>X4</code> every time the loop runs, which is different than non-volatile behaviour. This time the compiler things the value at <code>X4</code> will be different each time it is read. So without any assumption, it adds the value to <code>sum</code> every time the loop runs.</p>
<p>In both programs the value at the location <code>0xc000</code> can be cached by the processor. The subsequent read of the value at <code>0xc000</code> could be from processor’s cache but not from main memory. It is responsibility of the memory controller to maintain coherency between memory and processor cache. The <code>volatile</code> keyword has nothing to do here.</p>
<p>I believe these simple programs had explained the concept clear. The <code>volatile</code></p>
<h4 id="IS"><a href="#IS" class="headerlink" title="IS"></a>IS</h4><ul>
<li>To tell compiler not to make any assumption about the value stored in the variable</li>
</ul>
<h4 id="IS-NOT"><a href="#IS-NOT" class="headerlink" title="IS NOT"></a>IS NOT</h4><ul>
<li>To tell the compiler not to use any registers to hold the value</li>
<li>To tell the processor not to cache the value</li>
</ul>

  </div>
  
<nav class="footer-nav">
  
    <div class="footer-nav__prev">
      <div class="footer-nav__label">
        Newer
      </div>
      <a href="/64-bit-Mainline-kernel-on-Raspberry-Pi-3/">
        64-bit Mainline kernel on Raspberry Pi 3
      </a>
    </div>
  
  
    <div class="footer-nav__next">
      <div class="footer-nav__label">
        Older
      </div>
      <a href="/Anatomy-of-Linux-system-call-in-ARM64/">
        Anatomy of Linux system call in ARM64
      </a>
    </div>
  
</nav>


</article>


      </div>
      <div class="sidebar column is-4">
        <aside>
  
    <aside class="search widget">
  <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form" target="_blank">
    <div class="control has-icons-right">
      <input type="search" name="q" class="input" placeholder="Search">
      <span class="icon is-small is-right">
        <i class="fa fa-search"></i>
      </span>
    </div>
    <input type="hidden" name="sitesearch" value="https://eastrivervillage.com">
  </form>
</aside>

  
    <div class="widget-wrap">
  <div class="widget-title">author</div>
  <aside class="profile media widget">
    <!--figure class="profile-avatar media-left">
      <img src="/images/profile_author.jpg" class="avatar" alt="Balakumaran Kannan">
    </figure-->
    <div class="media-content">
      <p>
        <strong>
          <span>Balakumaran Kannan</span>
        </strong>
        <br>
        <span>System software engineer specilied in Linux. Experience spans from ARM32 board bring-up to multi datacenter virtualization stack management. Open source contributer. From Bangalore, India.</span>
        <br/>
        <br/>
        <a href="/about" target="_blank">
          <span style="color: orangered;text-decoration-line: underline;">Contact me</span>
        </a>
      </p>
    </div>
  </aside>
</div>

  
    
  <div class="widget-wrap">
    <div class="widget-title">recents</div>
    <div class="widget">
      <ul class="recent-post">
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/Custom-perf-with-custom-kernel/">
    <img src="/images/batmobile-tank.jpg" class="thumbnail is-6x6" alt="Custom perf with custom kernel">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/Custom-perf-with-custom-kernel/" class="">
                  Custom perf with custom kernel
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-11-19

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/perf/">perf</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/perf-setup/">
    <img src="/images/batmobile-tank.jpg" class="thumbnail is-6x6" alt="perf setup">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/perf-setup/" class="">
                  perf setup
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-10-31

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/setup/">setup</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/ubuntu/">ubuntu</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/perf/">perf</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/Quick-kernel-upgrade-with-kexec/">
    <img src="/images/time_to_upgrade.jpg" class="thumbnail is-6x6" alt="Quick kernel upgrade with kexec">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/Quick-kernel-upgrade-with-kexec/" class="">
                  Quick kernel upgrade with kexec
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-10-01

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/debian/">debian</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/stretch/">stretch</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kexec/">kexec</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/security/">security</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/upgrade/">upgrade</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/perf-kvm-to-profile-vm-exit/">
    <img src="/images/music-equalizer-1.jpg" class="thumbnail is-6x6" alt="perf kvm to profile vm_exit">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/perf-kvm-to-profile-vm-exit/" class="">
                  perf kvm to profile vm_exit
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-09-28

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/perf/">perf</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/kexec-tools-with-the-hidden-purgatory/">
    <img src="/images/purgatory.jpg" class="thumbnail is-6x6" alt="kexec - A travel to the purgatory">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/kexec-tools-with-the-hidden-purgatory/" class="">
                  kexec - A travel to the purgatory
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-01-20

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/ARMv8/">ARMv8</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/crazy-debugging/">crazy debugging</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget">
      <a href="/tags/ARM/" style="font-size: 10px;">ARM</a> <a href="/tags/ARMv8/" style="font-size: 12.5px;">ARMv8</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/RaspberryPi/" style="font-size: 15px;">RaspberryPi</a> <a href="/tags/about/" style="font-size: 10px;">about</a> <a href="/tags/bitbucket/" style="font-size: 10px;">bitbucket</a> <a href="/tags/build/" style="font-size: 12.5px;">build</a> <a href="/tags/c/" style="font-size: 10px;">c</a> <a href="/tags/chatbot/" style="font-size: 10px;">chatbot</a> <a href="/tags/clone/" style="font-size: 10px;">clone</a> <a href="/tags/compiler/" style="font-size: 10px;">compiler</a> <a href="/tags/cow/" style="font-size: 10px;">cow</a> <a href="/tags/crazy-debugging/" style="font-size: 10px;">crazy debugging</a> <a href="/tags/debian/" style="font-size: 10px;">debian</a> <a href="/tags/debug/" style="font-size: 12.5px;">debug</a> <a href="/tags/devpost/" style="font-size: 10px;">devpost</a> <a href="/tags/digitalocean/" style="font-size: 12.5px;">digitalocean</a> <a href="/tags/facebook/" style="font-size: 10px;">facebook</a> <a href="/tags/fork/" style="font-size: 10px;">fork</a> <a href="/tags/gcc/" style="font-size: 10px;">gcc</a> <a href="/tags/gdb/" style="font-size: 12.5px;">gdb</a> <a href="/tags/getpid/" style="font-size: 10px;">getpid</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/kernel/" style="font-size: 20px;">kernel</a> <a href="/tags/kernel-module/" style="font-size: 10px;">kernel module</a> <a href="/tags/kexec/" style="font-size: 10px;">kexec</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/memory-management/" style="font-size: 12.5px;">memory management</a> <a href="/tags/memory-management/" style="font-size: 10px;">memory_management</a> <a href="/tags/nodejs/" style="font-size: 12.5px;">nodejs</a> <a href="/tags/perf/" style="font-size: 15px;">perf</a> <a href="/tags/proc/" style="font-size: 10px;">proc</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/raspberrypi/" style="font-size: 12.5px;">raspberrypi</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/setup/" style="font-size: 15px;">setup</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/stretch/" style="font-size: 10px;">stretch</a> <a href="/tags/swap/" style="font-size: 10px;">swap</a> <a href="/tags/system-call/" style="font-size: 10px;">system call</a> <a href="/tags/ubuntu/" style="font-size: 12.5px;">ubuntu</a> <a href="/tags/upgrade/" style="font-size: 10px;">upgrade</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/virtual-memory/" style="font-size: 10px;">virtual_memory</a> <a href="/tags/vnc/" style="font-size: 10px;">vnc</a> <a href="/tags/wit-ai/" style="font-size: 10px;">wit.ai</a> <a href="/tags/yocto/" style="font-size: 17.5px;">yocto</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>

      </div>
    </div>
  </div>
  <footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.ja">
          <img alt="creative commons logo" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
        </a>
        <br />
        <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">this post is available under a </span> <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution ShareAlike license.</p>
    </div>
  </div>
</footer>


  <script>
    // HACK: custom style goes here
    tables = document.querySelectorAll('table');
    for (i = 0; i < tables.length; i++) {
      tables[i].classList.add("table", "is-bordered", "is-fullwidth");
    }
  </script>
</body>
</html>
