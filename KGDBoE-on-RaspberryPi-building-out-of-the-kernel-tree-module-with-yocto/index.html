
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115014323-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115014323-1');
  </script>
  <meta charset="utf-8">
  <title>KGDBoE on RaspberryPi - building out of the kernel tree module with yocto | East River Village</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
  <meta name="description" content="WARNING: KGDBoE cannot be used in Raspberry Pi due to lack of polling support in its network drivers. This post will be useful in future if polling is added. Also this post can be used as a reference">
<meta name="keywords" content="RaspberryPi,yocto,build,kernel module">
<meta property="og:type" content="article">
<meta property="og:title" content="KGDBoE on RaspberryPi - building out of the kernel tree module with yocto">
<meta property="og:url" content="https://eastrivervillage.com/KGDBoE-on-RaspberryPi-building-out-of-the-kernel-tree-module-with-yocto/index.html">
<meta property="og:site_name" content="East River Village">
<meta property="og:description" content="WARNING: KGDBoE cannot be used in Raspberry Pi due to lack of polling support in its network drivers. This post will be useful in future if polling is added. Also this post can be used as a reference">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://eastrivervillage.com/images/kgdboe.png">
<meta property="og:updated_time" content="2020-08-09T06:51:47.867Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KGDBoE on RaspberryPi - building out of the kernel tree module with yocto">
<meta name="twitter:description" content="WARNING: KGDBoE cannot be used in Raspberry Pi due to lack of polling support in its network drivers. This post will be useful in future if polling is added. Also this post can be used as a reference">
<meta name="twitter:image" content="https://eastrivervillage.com/images/kgdboe.png">
  <link rel="icon" href="/favicon.ico">
  
  
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5LB7LCD');</script>
    <!-- End Google Tag Manager -->
  


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Merriweather|Lobster|Lora|Roboto Mono">
  <link rel="stylesheet" href="/css/style.css">
  
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "KGDBoE on RaspberryPi - building out of the kernel tree module with yocto",
  "name": "KGDBoE on RaspberryPi - building out of the kernel tree module with yocto",
  "image": "/images/kgdboe.png",
  "datePublished": "2018-05-05T09:13:36.000Z",
  "dateModified": "2020-08-09T06:51:47.867Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://eastrivervillage.com/KGDBoE-on-RaspberryPi-building-out-of-the-kernel-tree-module-with-yocto/index.html"
  },
  "author": {
    "@type": "Person",
    "name": "Balakumaran Kannan",
    "image": "/images/profile_author.jpg",
    "description": "System software engineer specilied in Linux. Experience spans from ARM32 board bring-up to multi datacenter virtualization stack management. Open source contributer. From Bangalore, India."
  },
  "publisher": {
    "@type": "Organization",
    "name": "Balakumaran Kannan",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/profile_author.jpg"
    }
  }
}
</script>

  
</head>
</html>
<body>
  
  
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5LB7LCD');</script>
    <!-- End Google Tag Manager -->
  


  <header class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a href="/" class="navbar-item">
      East River Village
    </a>
  </div>
</header>

  <div class="container">
    <div class="columns">
      <div style="overflow:hidden;" class="main column">
        <article class="post">
  <figure class="post-thumbnail">
    
  <img src="/images/kgdboe.png" class="thumbnail " alt="KGDBoE on RaspberryPi - building out of the kernel tree module with yocto">


  </figure>
  <span>2018-05-05
</span>
  <h1 class="title">KGDBoE on RaspberryPi - building out of the kernel tree module with yocto</h1>
  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/RaspberryPi/">RaspberryPi</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/yocto/">yocto</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/build/">build</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel-module/">kernel module</a>
    
  </div>


  <div class="content">
    <div style="color:red;"><br><span style="font-weight: bold;">WARNING:</span> KGDBoE cannot be used in Raspberry Pi due to lack of polling support in its network drivers. This post will be useful in future if polling is added. Also this post can be used as a reference for building kernel module that is out of kernel tree.<br></div>

<h3 id="On-host"><a href="#On-host" class="headerlink" title="On host"></a>On host</h3><p>Building module in Raspberry Pi itself will take more time. Also it requires multiple development tools to be added to final image which will drastically increase the image size. To cross-compile we need SDK for Raspberry Pi.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/yocto</span><br><span class="line">$ <span class="built_in">source</span> poky/oe-init-build-env ../build/rpi3/</span><br><span class="line"></span><br><span class="line"><span class="comment">### Shell environment set up for builds. ###</span></span><br><span class="line"></span><br><span class="line">You can now run <span class="string">'bitbake &lt;target&gt;'</span></span><br><span class="line"></span><br><span class="line">Common targets are:</span><br><span class="line">    core-image-minimal</span><br><span class="line">    core-image-sato</span><br><span class="line">    meta-toolchain</span><br><span class="line">    meta-ide-support</span><br><span class="line"></span><br><span class="line">You can also run generated qemu images with a <span class="built_in">command</span> like <span class="string">'runqemu qemux86'</span></span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3</span><br><span class="line">$</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3</span><br><span class="line">$ bitbake core-image-base -c populate_sdk</span><br><span class="line">WARNING: Host distribution <span class="string">"ubuntu-17.10"</span> has not been validated with this version of the build system; you may possibly experience unexpected failures. It is recommended that you use a tested distribution.</span><br><span class="line">Loading cache: 100% |<span class="comment">#####################################################################################################| Time: 0:00:00</span></span><br><span class="line">Loaded 2783 entries from dependency cache.</span><br><span class="line">NOTE: Resolving any missing task queue dependencies</span><br><span class="line"></span><br><span class="line">Build Configuration:</span><br><span class="line">BB_VERSION           = <span class="string">"1.36.0"</span></span><br><span class="line">BUILD_SYS            = <span class="string">"x86_64-linux"</span></span><br><span class="line">NATIVELSBSTRING      = <span class="string">"universal"</span></span><br><span class="line">TARGET_SYS           = <span class="string">"aarch64-poky-linux"</span></span><br><span class="line">MACHINE              = <span class="string">"raspberrypi3-64"</span></span><br><span class="line">DISTRO               = <span class="string">"poky"</span></span><br><span class="line">DISTRO_VERSION       = <span class="string">"2.4.2"</span></span><br><span class="line">TUNE_FEATURES        = <span class="string">"aarch64"</span></span><br><span class="line">TARGET_FPU           = <span class="string">""</span></span><br><span class="line">meta                 </span><br><span class="line">meta-poky            </span><br><span class="line">meta-yocto-bsp       = <span class="string">"rocko:fdeecc901196bbccd7c5b1ea4268a2cf56764a62"</span></span><br><span class="line">meta-oe              </span><br><span class="line">meta-multimedia      </span><br><span class="line">meta-networking      </span><br><span class="line">meta-python          = <span class="string">"rocko:a65c1acb1822966c3553de9fc98d8bb6be705c4e"</span></span><br><span class="line">meta-raspberrypi     = <span class="string">"rocko:20358ec57a8744b0a02da77b283620fb718b0ee0"</span></span><br><span class="line"></span><br><span class="line">Initialising tasks: 100% |<span class="comment">################################################################################################| Time: 0:00:11</span></span><br><span class="line">NOTE: Executing SetScene Tasks</span><br><span class="line">NOTE: Executing RunQueue Tasks</span><br><span class="line">NOTE: Tasks Summary: Attempted 3589 tasks of <span class="built_in">which</span> 3589 didn<span class="string">'t need to be rerun and all succeeded.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Summary: There was 1 WARNING message shown.</span></span><br><span class="line"><span class="string">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3</span></span><br></pre></td></tr></table></figure></p>
<p>Once done, the script to install SDK will be present in <code>./tmp/deploy/sdk/</code>. Run the script <code>poky-glibc-x86_64-core-image-base-aarch64-toolchain-2.4.2.sh</code>. This will install the SDK in <code>/opt/</code> directory by default.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3</span><br><span class="line">$ ./tmp/deploy/sdk/poky-glibc-x86_64-core-image-base-aarch64-toolchain-2.4.2.sh </span><br><span class="line">Poky (Yocto Project Reference Distro) SDK installer version 2.4.2</span><br><span class="line">=================================================================</span><br><span class="line">Enter target directory <span class="keyword">for</span> SDK (default: /opt/poky/2.4.2): </span><br><span class="line">The directory <span class="string">"/opt/poky/2.4.2"</span> already contains a SDK <span class="keyword">for</span> this architecture.</span><br><span class="line">If you <span class="built_in">continue</span>, existing files will be overwritten! Proceed[y/N]? N</span><br><span class="line">Installation aborted!</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3</span><br><span class="line">$ ls /opt/poky/2.4.2/</span><br><span class="line">environment-setup-aarch64-poky-linux  sysroots/                             </span><br><span class="line">site-config-aarch64-poky-linux        version-aarch64-poky-linux            </span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<p>I didn’t overwrite files as I have installed it already. The script <code>environment-setup-aarch64-poky-linux</code> is the one that will setup the cross-build environment for us.</p>
<p>Clone the KGDBoE source from Github. Setup cross-build environment and build the module.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/sysprogs/kgdboe.git</span><br><span class="line">Cloning into <span class="string">'kgdboe'</span>...</span><br><span class="line">remote: Counting objects: 172, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 172 (delta 0), reused 0 (delta 0), pack-reused 171</span><br><span class="line">Receiving objects: 100% (172/172), 51.95 KiB | 81.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (114/114), <span class="keyword">done</span>.</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile</span><br><span class="line">$</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile</span><br><span class="line">$ <span class="built_in">cd</span> kgdboe</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$ <span class="built_in">source</span> /opt/poky/2.4.2/environment-setup-aarch64-poky-linux </span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$ make -C /home/kaba/Desktop/yocto/build/rpi3/tmp/work/raspberrypi3_64-poky-linux/linux-raspberrypi/1_4.9.59+gitAUTOINC+e7976b2aff-r0/linux-raspberrypi3_64-standard-build M=$(<span class="built_in">pwd</span>)</span><br><span class="line">make: Entering directory <span class="string">'/home/kaba/Desktop/yocto/build/rpi3/tmp/work/raspberrypi3_64-poky-linux/linux-raspberrypi/1_4.9.59+gitAUTOINC+e7976b2aff-r0/linux-raspberrypi3_64-standard-build'</span></span><br><span class="line">  LD      /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/built-in.o</span><br><span class="line">  CC [M]  /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/irqsync.o</span><br><span class="line">  CC [M]  /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe_main.o</span><br><span class="line">  CC [M]  /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe_io.o</span><br><span class="line">/home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe_io.c: In <span class="keyword">function</span> <span class="string">'force_single_cpu_mode'</span>:</span><br><span class="line">/home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe_io.c:119:3: error: implicit declaration of <span class="keyword">function</span> <span class="string">'cpu_down'</span>; did you mean <span class="string">'cpu_die'</span>? [-Werror=implicit-function-declaration]</span><br><span class="line">   cpu_down(i);</span><br><span class="line">   ^~~~~~~~</span><br><span class="line">   cpu_die</span><br><span class="line">cc1: some warnings being treated as errors</span><br><span class="line">/home/kaba/Desktop/yocto/build/rpi3/tmp/work-shared/raspberrypi3-64/kernel-source/scripts/Makefile.build:293: recipe <span class="keyword">for</span> target <span class="string">'/home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe_io.o'</span> failed</span><br><span class="line">make[3]: *** [/home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe_io.o] Error 1</span><br><span class="line">/home/kaba/Desktop/yocto/build/rpi3/tmp/work-shared/raspberrypi3-64/kernel-source/Makefile:1493: recipe <span class="keyword">for</span> target <span class="string">'_module_/home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe'</span> failed</span><br><span class="line">make[2]: *** [_module_/home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe] Error 2</span><br><span class="line">Makefile:150: recipe <span class="keyword">for</span> target <span class="string">'sub-make'</span> failed</span><br><span class="line">make[1]: *** [sub-make] Error 2</span><br><span class="line">Makefile:24: recipe <span class="keyword">for</span> target <span class="string">'__sub-make'</span> failed</span><br><span class="line">make: *** [__sub-make] Error 2</span><br><span class="line">make: Leaving directory <span class="string">'/home/kaba/Desktop/yocto/build/rpi3/tmp/work/raspberrypi3_64-poky-linux/linux-raspberrypi/1_4.9.59+gitAUTOINC+e7976b2aff-r0/linux-raspberrypi3_64-standard-build'</span></span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<p><code>cpu_down</code> function is not available in ARM platform. It is used to shutdown all but one core when debugging, because debugging with single CPU is desirable unless e debug SMP related issues. I couldn’t find equivalent ARM function. So let’s comment out this call and disable CPUs during boot using <code>bootargs</code>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$ git diff</span><br><span class="line">diff --git a/kgdboe_io.c b/kgdboe_io.c</span><br><span class="line">index 1d02360..0d32c36 100644</span><br><span class="line">--- a/kgdboe_io.c</span><br><span class="line">+++ b/kgdboe_io.c</span><br><span class="line">@@ -115,8 +115,8 @@ void force_single_cpu_mode(void)</span><br><span class="line">        printk(KERN_INFO &quot;kgdboe: single-core mode enabled. Shutting down all cores except #0. This is slower, but safer.\n&quot;);</span><br><span class="line">        printk(KERN_INFO &quot;kgdboe: you can try using multi-core mode by specifying the following argument:\n&quot;);</span><br><span class="line">        printk(KERN_INFO &quot;\tinsmod kgdboe.ko force_single_core = 0\n&quot;);</span><br><span class="line">-       for (int i = 1; i &lt; nr_cpu_ids; i++)</span><br><span class="line">-               cpu_down(i);</span><br><span class="line">+       /*for (int i = 1; i &lt; nr_cpu_ids; i++)*/</span><br><span class="line">+               /*cpu_down(i);*/</span><br><span class="line"> &#125;</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<p>This time the build gave following linker error.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aarch64-poky-linux-ld: unrecognized option <span class="string">'-Wl,-O1'</span></span><br></pre></td></tr></table></figure></p>
<p>This is because the <code>LDFLAGS</code> environment variable. Kernel module Makefile requires <code>LDFLAGS</code> to be set as only the options without <code>-Wl</code>. So it appends whatever there in <code>LDFLAGS</code> with <code>-Wl</code>. As <code>LDFLAGS</code> has another <code>-Wl</code>, we are getting unrecognized option error. So remove all <code>-Wl</code>s from <code>LDFLAGS</code>.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$LDFLAGS</span> </span><br><span class="line">-Wl,-O1 -Wl,--<span class="built_in">hash</span>-style=gnu -Wl,--as-needed</span><br><span class="line">$ <span class="built_in">export</span> LDFLAGS=<span class="string">"-O1 --hash-style=gnu --as-needed"</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$LDFLAGS</span> </span><br><span class="line">-O1 --<span class="built_in">hash</span>-style=gnu --as-needed</span><br></pre></td></tr></table></figure></p>
<p>And build now.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$ make -C /home/kaba/Desktop/yocto/build/rpi3/tmp/work/raspberrypi3_64-poky-linux/linux-raspberrypi/1_4.9.59+gitAUTOINC+e7976b2aff-r0/linux-raspberrypi3_64-standard-build M=$(<span class="built_in">pwd</span>)</span><br><span class="line">make: Entering directory <span class="string">'/home/kaba/Desktop/yocto/build/rpi3/tmp/work/raspberrypi3_64-poky-linux/linux-raspberrypi/1_4.9.59+gitAUTOINC+e7976b2aff-r0/linux-raspberrypi3_64-standard-build'</span></span><br><span class="line">  LD [M]  /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe.o</span><br><span class="line">  Building modules, stage 2.</span><br><span class="line">  MODPOST 1 modules</span><br><span class="line">  CC      /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe.mod.o</span><br><span class="line">  LD [M]  /home/kaba/Desktop/yocto/build/rpi3/cross-compile/kgdboe/kgdboe.ko</span><br><span class="line">make: Leaving directory <span class="string">'/home/kaba/Desktop/yocto/build/rpi3/tmp/work/raspberrypi3_64-poky-linux/linux-raspberrypi/1_4.9.59+gitAUTOINC+e7976b2aff-r0/linux-raspberrypi3_64-standard-build'</span></span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$ ls kgdboe.ko</span><br><span class="line">-rw-r--r-- 1 kaba kaba 2.1M May  5 16:11 kgdboe.ko</span><br><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<p>Now <code>scp</code> the module <code>kgdboe.ko</code> to Raspberry Pi.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kaba@kaba-Vostro-1550:~/Desktop/yocto/build/rpi3/cross-compile/kgdboe</span><br><span class="line">$ scp kgdboe.ko root@192.168.0.101</span><br></pre></td></tr></table></figure></p>
<h3 id="On-Target"><a href="#On-Target" class="headerlink" title="On Target"></a>On Target</h3><p>Add <code>maxcpus=1</code> option to Raspberry Pi’s kernel command line to disable all but one core. The <code>bootargs</code> can be found in the file <code>cmdline.txt</code> in first partition of the SD card.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@192.168.0.101</span><br><span class="line">Last login: Sat May  5 07:59:44 2018 from 192.168.0.108</span><br><span class="line">root@raspberrypi3-64:~<span class="comment"># ls</span></span><br><span class="line">kgdboe.ko</span><br><span class="line">root@raspberrypi3-64:~<span class="comment"># mount /dev/mmcblk0p1 /boot</span></span><br><span class="line">root@raspberrypi3-64:~<span class="comment"># cat /boot/cmdline.txt </span></span><br><span class="line">dwc_otg.lpm_enable=0 console=serial0,115200 root=/dev/mmcblk0p2 rootfstype=ext4 rootwait maxcpus=1</span><br><span class="line">root@raspberrypi3-64:~<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>Reboot the Pi and try installing the module.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi3-64:~<span class="comment"># cat /proc/cmdline </span></span><br><span class="line">8250.nr_uarts=0 cma=256M bcm2708_fb.fbwidth=1920 bcm2708_fb.fbheight=1080 bcm2708_fb.fbswap=1 vc_mem.mem_base=0x3ec00000 vc_mem.mem_size=0x40000000  dwc_otg.lpm_enable=0 console=ttyS0,115200 root=/dev/mmcblk0p2 rootfstype=ext4 rootwait maxcpus=1</span><br><span class="line">root@raspberrypi3-64:~<span class="comment"># insmod kgdboe.ko </span></span><br><span class="line">insmod: ERROR: could not insert module kgdboe.ko: Invalid parameters</span><br><span class="line">root@raspberrypi3-64:~<span class="comment"># dmesg | tail -5</span></span><br><span class="line">[ 1211.816691] kgdboe: Failed to setup netpoll <span class="keyword">for</span> eth0, code -524</span><br><span class="line">[ 8814.348313] netpoll: kgdboe: <span class="built_in">local</span> IP 1.1.1.101</span><br><span class="line">[ 8814.348344] netpoll: kgdboe: eth0 doesn<span class="string">'t support polling, aborting</span></span><br><span class="line"><span class="string">[ 8814.348360] kgdboe: Failed to setup netpoll for eth0, code -524</span></span><br><span class="line"><span class="string">root@raspberrypi3-64:~#</span></span><br></pre></td></tr></table></figure></p>
<p>Due to lack of polling support, Kernel debugging over Ethernet is not available for as of now. If you are reading this, you are part of the clan having hope.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li>[<a href="http://sysprogs.com/VisualKernel/kgdboe/tutorial/]" target="_blank" rel="noopener">http://sysprogs.com/VisualKernel/kgdboe/tutorial/]</a></li>
<li>[<a href="https://github.com/raspberrypi/linux/blob/rpi-4.14.y/arch/arm64/Kconfig]" target="_blank" rel="noopener">https://github.com/raspberrypi/linux/blob/rpi-4.14.y/arch/arm64/Kconfig]</a></li>
<li>[<a href="https://sysprogs.com/w/forums/topic/two-problems-1-linuxkerneldebughelper-seg-fault-and-2-kgdboe-build-fails/]" target="_blank" rel="noopener">https://sysprogs.com/w/forums/topic/two-problems-1-linuxkerneldebughelper-seg-fault-and-2-kgdboe-build-fails/]</a></li>
<li>[<a href="https://stackoverflow.com/questions/25407320/what-is-the-signification-of-ldflags]" target="_blank" rel="noopener">https://stackoverflow.com/questions/25407320/what-is-the-signification-of-ldflags]</a></li>
<li>[<a href="https://github.com/raspberrypi/linux/issues/1877]" target="_blank" rel="noopener">https://github.com/raspberrypi/linux/issues/1877]</a></li>
</ul>

  </div>
  
<nav class="footer-nav">
  
    <div class="footer-nav__prev">
      <div class="footer-nav__label">
        Newer
      </div>
      <a href="/KGDB-KDB-over-serial-with-RaspberryPi/">
        KGDB/KDB over serial with Raspberry Pi
      </a>
    </div>
  
  
    <div class="footer-nav__next">
      <div class="footer-nav__label">
        Older
      </div>
      <a href="/Raspberry-Pi-dishes-from-Yocto-cuisine/">
        Raspberry Pi dishes from Yocto cuisine
      </a>
    </div>
  
</nav>


</article>


      </div>
      <div class="sidebar column is-4">
        <aside>
  
    <aside class="search widget">
  <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form" target="_blank">
    <div class="control has-icons-right">
      <input type="search" name="q" class="input" placeholder="Search">
      <span class="icon is-small is-right">
        <i class="fa fa-search"></i>
      </span>
    </div>
    <input type="hidden" name="sitesearch" value="https://eastrivervillage.com">
  </form>
</aside>

  
    <div class="widget-wrap">
  <div class="widget-title">author</div>
  <aside class="profile media widget">
    <!--figure class="profile-avatar media-left">
      <img src="/images/profile_author.jpg" class="avatar" alt="Balakumaran Kannan">
    </figure-->
    <div class="media-content">
      <p>
        <strong>
          <span>Balakumaran Kannan</span>
        </strong>
        <br>
        <span>System software engineer specilied in Linux. Experience spans from ARM32 board bring-up to multi datacenter virtualization stack management. Open source contributer. From Bangalore, India.</span>
        <br/>
        <br/>
        <a href="/about" target="_blank">
          <span style="color: orangered;text-decoration-line: underline;">Contact me</span>
        </a>
      </p>
    </div>
  </aside>
</div>

  
    
  <div class="widget-wrap">
    <div class="widget-title">recents</div>
    <div class="widget">
      <ul class="recent-post">
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/Custom-perf-with-custom-kernel/">
    <img src="/images/batmobile-tank.jpg" class="thumbnail is-6x6" alt="Custom perf with custom kernel">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/Custom-perf-with-custom-kernel/" class="">
                  Custom perf with custom kernel
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-11-19

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/perf/">perf</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/perf-setup/">
    <img src="/images/batmobile-tank.jpg" class="thumbnail is-6x6" alt="perf setup">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/perf-setup/" class="">
                  perf setup
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-10-31

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/setup/">setup</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/ubuntu/">ubuntu</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/perf/">perf</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/Quick-kernel-upgrade-with-kexec/">
    <img src="/images/time_to_upgrade.jpg" class="thumbnail is-6x6" alt="Quick kernel upgrade with kexec">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/Quick-kernel-upgrade-with-kexec/" class="">
                  Quick kernel upgrade with kexec
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-10-01

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/debian/">debian</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/stretch/">stretch</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kexec/">kexec</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/security/">security</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/upgrade/">upgrade</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/perf-kvm-to-profile-vm-exit/">
    <img src="/images/music-equalizer-1.jpg" class="thumbnail is-6x6" alt="perf kvm to profile vm_exit">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/perf-kvm-to-profile-vm-exit/" class="">
                  perf kvm to profile vm_exit
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-09-28

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/perf/">perf</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
          <li class="recent-post-item media">
            <figure class="media-left">
              
  <a href="/kexec-tools-with-the-hidden-purgatory/">
    <img src="/images/purgatory.jpg" class="thumbnail is-6x6" alt="kexec - A travel to the purgatory">
  </a>


            </figure>
            <div class="media-content">
              <p class="">
                <a href="/kexec-tools-with-the-hidden-purgatory/" class="">
                  kexec - A travel to the purgatory
                </a>
              </p>
              <p class="">
                <!--small>
                  2020-01-20

                </small>
                <br/-->
                <small>
                  
  <div class="tags">
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/kernel/">kernel</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/linux/">linux</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/ARMv8/">ARMv8</a>
    
      <a class="tag is-white" style="color: darkmagenta; padding-left:0;" href="/tags/crazy-debugging/">crazy debugging</a>
    
  </div>


                </small>
              </p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget">
      <a href="/tags/ARM/" style="font-size: 10px;">ARM</a> <a href="/tags/ARMv8/" style="font-size: 12.5px;">ARMv8</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/RaspberryPi/" style="font-size: 15px;">RaspberryPi</a> <a href="/tags/about/" style="font-size: 10px;">about</a> <a href="/tags/bitbucket/" style="font-size: 10px;">bitbucket</a> <a href="/tags/build/" style="font-size: 12.5px;">build</a> <a href="/tags/c/" style="font-size: 10px;">c</a> <a href="/tags/chatbot/" style="font-size: 10px;">chatbot</a> <a href="/tags/clone/" style="font-size: 10px;">clone</a> <a href="/tags/compiler/" style="font-size: 10px;">compiler</a> <a href="/tags/cow/" style="font-size: 10px;">cow</a> <a href="/tags/crazy-debugging/" style="font-size: 10px;">crazy debugging</a> <a href="/tags/debian/" style="font-size: 10px;">debian</a> <a href="/tags/debug/" style="font-size: 12.5px;">debug</a> <a href="/tags/devpost/" style="font-size: 10px;">devpost</a> <a href="/tags/digitalocean/" style="font-size: 12.5px;">digitalocean</a> <a href="/tags/facebook/" style="font-size: 10px;">facebook</a> <a href="/tags/fork/" style="font-size: 10px;">fork</a> <a href="/tags/gcc/" style="font-size: 10px;">gcc</a> <a href="/tags/gdb/" style="font-size: 12.5px;">gdb</a> <a href="/tags/getpid/" style="font-size: 10px;">getpid</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/kernel/" style="font-size: 20px;">kernel</a> <a href="/tags/kernel-module/" style="font-size: 10px;">kernel module</a> <a href="/tags/kexec/" style="font-size: 10px;">kexec</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/memory-management/" style="font-size: 12.5px;">memory management</a> <a href="/tags/memory-management/" style="font-size: 10px;">memory_management</a> <a href="/tags/nodejs/" style="font-size: 12.5px;">nodejs</a> <a href="/tags/perf/" style="font-size: 15px;">perf</a> <a href="/tags/proc/" style="font-size: 10px;">proc</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/raspberrypi/" style="font-size: 12.5px;">raspberrypi</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/setup/" style="font-size: 15px;">setup</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/stretch/" style="font-size: 10px;">stretch</a> <a href="/tags/swap/" style="font-size: 10px;">swap</a> <a href="/tags/system-call/" style="font-size: 10px;">system call</a> <a href="/tags/ubuntu/" style="font-size: 12.5px;">ubuntu</a> <a href="/tags/upgrade/" style="font-size: 10px;">upgrade</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/virtual-memory/" style="font-size: 10px;">virtual_memory</a> <a href="/tags/vnc/" style="font-size: 10px;">vnc</a> <a href="/tags/wit-ai/" style="font-size: 10px;">wit.ai</a> <a href="/tags/yocto/" style="font-size: 17.5px;">yocto</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>

      </div>
    </div>
  </div>
  <footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.ja">
          <img alt="creative commons logo" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
        </a>
        <br />
        <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">this post is available under a </span> <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution ShareAlike license.</p>
    </div>
  </div>
</footer>


  <script>
    // HACK: custom style goes here
    tables = document.querySelectorAll('table');
    for (i = 0; i < tables.length; i++) {
      tables[i].classList.add("table", "is-bordered", "is-fullwidth");
    }
  </script>
</body>
</html>
